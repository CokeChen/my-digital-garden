---
layout: default
title: Search
permalink: /search.html
---

<input type="text" id="search" placeholder="Search" />

<ul id="search-results"></ul>

<script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>

<!-- 引入 lunr.js 的简体中文支持 -->
<script src="https://unpkg.com/lunr-languages/lunr.stemmer.support.min.js"></script>
<script src="https://unpkg.com/lunr-languages/lunr.zh.min.js"></script>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    var searchField = document.getElementById('search');
    var searchResults = document.getElementById('search-results');
    var documents = [
    {% for post in site.notes %}
        {
          "id": "{{ post.url }}",
          "title": "{{ post.title | replace: '&amp;', '&' }}",
          "content": "{{ post.content | strip_html | strip_newlines | replace: '&amp;', '&' }}"
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]; 
    var idx = lunr(function () {
    this.use(lunr.zh);
    this.ref('id');
    this.field('title');
    this.field('content');

    documents.forEach(function (doc) {
      this.add(doc);
    }, this);
});
    console.log(documents);
    searchField.addEventListener('input', function () {
      var query = this.value;
      searchResults.innerHTML = '';

      if (query.length < 2) {
        return;
      }

      var results = idx.search(query);
      if (results.length === 0) {
        searchResults.innerHTML = '<li>No results found</li>';
        return;
      }

      results.forEach(function (result) {
        var doc = documents.find(function (doc) {
          return doc.id === result.ref;
        });

        var listItem = document.createElement('li');
        var link = document.createElement('a');
        link.href = doc.id;
        link.textContent = doc.title;
        listItem.appendChild(link);
        searchResults.appendChild(listItem);
      });
    });
  });
</script>


